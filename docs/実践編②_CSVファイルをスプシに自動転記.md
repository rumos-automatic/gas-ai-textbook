# 実践編② CSVファイルをスプシに自動転記

GoogleドライブのCSVファイルまたはテキストファイルを、スプレッドシートに自動転記するツールを作成します。

**推奨学習日数**：3日間

---

## 📋 この実践で学ぶこと

- Googleドライブからファイルを取得する方法
- CSVファイルを解析してスプレッドシートに転記する方法
- カスタムメニューで簡単に実行できるようにする方法

---

## 🎯 作業の概要

この実践では、以下のような自動化ツールを作成します：

1. Googleドライブの特定フォルダからCSVファイルを取得
2. CSVファイルの内容を解析
3. Googleスプレッドシートに自動転記
4. カスタムメニューを追加して、ボタンクリックで実行できるようにする

---

## ステップ1：作業の棚卸

まず、現在の作業を具体的に書き出しましょう。

### 現在の手作業の流れ

1. Googleドライブを開く
2. 「注文データ」フォルダを開く
3. CSVファイルをダウンロード
4. Googleスプレッドシートを開く
5. 「ファイル」→「インポート」→「アップロード」
6. CSVファイルを選択してインポート
7. データの形式を確認・調整
8. 必要に応じてデータをクリーニング

この作業を毎日繰り返している場合、GASで自動化することで大幅に時間を節約できます。

---

## ステップ2：ChatGPTにプロンプトを送る

作業の棚卸が完了したら、ChatGPTにツール作成を依頼しましょう。

### プロンプト例

```
Google Apps Scriptで、以下の機能を持つツールを作成してください。

【やりたいこと】
Googleドライブの特定フォルダにあるCSVファイルを、Googleスプレッドシートに自動転記する

【現在の手順】
1. Googleドライブを開く
2. フォルダID「XXXXXXXXXXXXX」のフォルダを開く
3. 最新のCSVファイルを取得
4. CSVファイルの内容を解析
5. Googleスプレッドシートの「データ」シートに転記
   - A列：注文番号
   - B列：顧客名
   - C列：商品名
   - D列：数量
   - E列：金額
6. 既存データに追記する形で転記

【その他の要望】
- CSVファイルの1行目はヘッダー行なのでスキップする
- 重複チェック機能を付けて、同じ注文番号は転記しないようにする
- 処理が完了したら、処理件数をログに出力する
```

ChatGPTが、このプロンプトに基づいてGASコードを生成してくれます。

---

## ステップ3：コードをGASエディタに貼り付け

ChatGPTが生成したコードを、GASエディタに貼り付けましょう。

### 手順

1. Googleスプレッドシートを開く
2. メニューから「拡張機能」→「Apps Script」をクリック
3. スクリプトエディタが開く
4. ChatGPTが生成したコードをすべて選択してコピー
5. エディタに貼り付け
6. 「保存」ボタンをクリック（Ctrl + S または Cmd + S）

---

## ステップ4：動作確認

コードを貼り付けたら、実際にツールが正しく動作するか確認しましょう。

### 確認ポイント

1. **Googleドライブからファイルが正しく取得されているか**
   - 指定したフォルダIDのフォルダから、CSVファイルが取得されているか

2. **CSVファイルの内容が正しく解析されているか**
   - ヘッダー行がスキップされているか
   - データが正しく列に分割されているか

3. **スプレッドシートに正しく転記されているか**
   - データが正しい列に入力されているか
   - 既存データに追記されているか

4. **重複チェックが機能しているか**
   - 同じ注文番号のデータが重複して転記されないか

### もしエラーが出たら

エラーが出た場合は、エラーメッセージをコピーして、ChatGPTに送りましょう。

**例：**
```
以下のエラーが出ました。修正してください。

[エラーメッセージをここに貼り付け]
```

---

## ステップ5：カスタムメニュー設定で使いやすくする

ツールが正しく動作することを確認したら、最後にカスタムメニューを追加しましょう。カスタムメニューを追加することで、**スプレッドシートのメニューバーからボタンクリックで実行できる**ようになります。

### 📋 カスタムメニューとは

カスタムメニューとは、スプレッドシートのメニューバーに**オリジナルのボタン**を追加できる機能です。

**メリット：**
- クリックするだけでツールを実行できる
- 「拡張機能 → Apps Script」を開く必要なし
- 初心者でも簡単に使える
- 複数の機能をまとめることも可能

### ⚠️ 作り方の超重要ポイント

カスタムメニューは、ツールを作ったのと**【同じチャット内】で続けて依頼しましょう！**

これが非常に重要です。新しいチャットで依頼すると、ChatGPTが関数名を把握していないため、エラーが発生する可能性があります。

#### ❌ 悪い例

**新しいチャットで**
> メニューを作って

→ AIが関数名を知らないのでエラー

#### ✅ 良い例

**ツール作成後、同じチャットで**
> このツールをメニューから実行できるようにして

→ AIが関数名を把握しているのでスムーズ！

### 実践②をメニュー化する依頼例

実践②（CSVファイル転記ツール）をメニュー化する場合の依頼例です。

**プロンプト例（ツール作成後、同じチャットで続けて）：**

```
このツールをスプレッドシートのメニューから実行できるようにしてください。

メニュー名：📦 注文管理ツール
項目名：📥 注文データを取り込む
```

**これだけでOK！** 関数名とか難しいことは気にしなくて大丈夫です。ChatGPTが自動的に判断して、カスタムメニューのコードを生成してくれます。

### 実装手順

ChatGPTがカスタムメニューのコードを生成したら、以下の手順で実装します。

#### 1. ChatGPTにプロンプトを送る → コードが作成される

上記のプロンプトを送ると、ChatGPTがカスタムメニューのコードを生成します。

通常、`onOpen()` という関数が追加されます。この関数は、スプレッドシートを開いたときに自動的に実行され、カスタムメニューを表示します。

**コード例：**

```javascript
function onOpen() {
  const ui = SpreadsheetApp.getUi();
  ui.createMenu('📦 注文管理ツール')
    .addItem('📥 注文データを取り込む', 'importOrderData')
    .addToUi();
}

function importOrderData() {
  // CSVファイルを取り込む処理
  // ...
}
```

#### 2. スプレッドシートを開く → 「拡張機能 → Apps Script」

スプレッドシートを開き、メニューから「拡張機能」→「Apps Script」をクリックします。

#### 3. コードを貼り付け保存

ChatGPTが生成したコードを、GASエディタに貼り付けて保存します。

**重要：**
- 既存のコードに`onOpen()`関数を追加する形で貼り付けてください
- 既存のコードを削除しないように注意！

#### 4. スプレッドシートをリロード（F5キー）

コードを保存したら、スプレッドシートのタブに戻り、**F5キー**を押してページをリロードします。

#### 5. メニューバーに表示される！

リロード後、スプレッドシートのメニューバーに「📦 注文管理ツール」というメニューが追加されます。

クリックすると、「📥 注文データを取り込む」という項目が表示されます。この項目をクリックすると、ツールが実行されます。

### 💡 ポイント

カスタムメニューを使う際のポイントをまとめます。

- **メニュー名は自由につけられる**
  - 日本語でも英語でもOK
  - 絵文字を使うと見つけやすい（例：📦、📥、📧）

- **絵文字を使うと見つけやすい**
  - メニューが増えても、絵文字があれば一目で分かる

- **複数の機能をまとめることも可能**
  - 1つのメニューに複数の項目を追加できる
  - 例：「📦 注文管理ツール」の中に「📥 注文データを取り込む」「📊 注文データを集計」「📧 顧客にメール送信」など

**複数の機能を追加する例：**

```javascript
function onOpen() {
  const ui = SpreadsheetApp.getUi();
  ui.createMenu('📦 注文管理ツール')
    .addItem('📥 注文データを取り込む', 'importOrderData')
    .addItem('📊 注文データを集計', 'aggregateOrderData')
    .addItem('📧 顧客にメール送信', 'sendEmailToCustomers')
    .addToUi();
}
```

---

## ✅ まとめ

この実践では、以下のことを学びました：

- Googleドライブから CSVファイルを取得してスプレッドシートに転記する方法
- カスタムメニューを追加して、ボタンクリックで実行できるようにする方法
- カスタムメニュー作成時の重要ポイント（同じチャット内で依頼する）

次の実践では、Googleフォームの自動返信ボットを作成します。お疲れ様でした！
