# 実践編① メール内容をスプシに自動転記

Gmailから特定のメールを検索し、スプレッドシートに自動転記するツールを作成します。

**推奨学習日数**：3日間

---

## 📋 この実践で学ぶこと

- Gmailからメールを検索する方法
- メール内容をスプレッドシートに転記する方法
- 初回承認の手順
- トリガー設定で自動実行する方法

---

## 🎯 作業の概要

この実践では、以下のような自動化ツールを作成します：

1. Gmailで特定の件名を含むメールを検索
2. メールの内容（件名、差出人、受信日、本文など）を抽出
3. Googleスプレッドシートに自動転記
4. トリガー設定で毎日自動実行

---

## ステップ1：作業の棚卸

まず、現在の作業を具体的に書き出しましょう。

### 現在の手作業の流れ

1. Gmailを開く
2. 検索ボックスで「注文」「請求書」などのキーワードで検索
3. メールを1つずつ開く
4. 件名、差出人、受信日、本文を確認
5. Googleスプレッドシートに手動で転記
   - A列：受信日
   - B列：件名
   - C列：差出人
   - D列：本文（または本文の一部）
6. ステータス列に「未対応」と入力

この作業を毎日繰り返している場合、GASで自動化することで大幅に時間を節約できます。

---

## ステップ2：ChatGPTにプロンプトを送る

作業の棚卸が完了したら、ChatGPTにツール作成を依頼しましょう。

### プロンプト例

```
Google Apps Scriptで、以下の機能を持つツールを作成してください。

【やりたいこと】
Gmailで特定のメールを検索し、内容をGoogleスプレッドシートに自動転記する

【現在の手順】
1. Gmailを開く
2. 件名に「注文」を含むメールを検索
3. メールの内容を確認
   - 件名
   - 差出人
   - 受信日
   - 本文
4. Googleスプレッドシートに転記
   - A列：受信日（YYYY/MM/DD形式）
   - B列：件名
   - C列：差出人メールアドレス
   - D列：本文の冒頭200文字
5. E列に「未対応」ステータスを付ける

【その他の要望】
- 重複チェック機能を付けて、同じメールは転記しないようにする
- 処理が完了したら、処理件数をログに出力する
```

ChatGPTが、このプロンプトに基づいてGASコードを生成してくれます。

---

## ステップ3：コードをGASエディタに貼り付け

ChatGPTが生成したコードを、GASエディタに貼り付けましょう。

### 手順

1. Googleスプレッドシートを開く
2. メニューから「拡張機能」→「Apps Script」をクリック
3. スクリプトエディタが開く
4. ChatGPTが生成したコードをすべて選択してコピー
5. エディタに貼り付け
6. 「保存」ボタンをクリック（Ctrl + S または Cmd + S）

---

## ステップ4：初回承認

GASを初めて実行する際は、Googleアカウントへの**承認**が必要です。

### 承認手順

1. **関数を選択**
   - スクリプトエディタ上部の「関数を選択」プルダウンから、実行したい関数（例：`transferEmailsToSheet`）を選択

2. **実行ボタンをクリック**
   - 「▶️ 実行」ボタンをクリック

3. **「許可を確認」ダイアログが表示される**
   - 「権限を確認」ボタンをクリック

4. **Googleアカウントを選択**
   - 使用するGoogleアカウントを選択

5. **「このアプリは確認されていません」という警告が表示される**
   - 「詳細」をクリック
   - 「（プロジェクト名）に移動」をクリック

6. **権限を許可**
   - 「許可」ボタンをクリック

7. **承認完了**
   - これで初回承認が完了しました

### ⚠️ 注意点

- 初回承認は、GASがGmailやスプレッドシートにアクセスする権限を得るために必要です
- 自分で作成したスクリプトであれば、安全に承認して問題ありません
- 他人が作成したスクリプトを実行する場合は、内容を十分に確認してから承認してください

---

## ステップ5：動作確認

承認が完了したら、実際にツールが正しく動作するか確認しましょう。

### 確認ポイント

1. **メールが正しく検索されているか**
   - 件名に「注文」を含むメールが対象になっているか

2. **スプレッドシートに正しく転記されているか**
   - 受信日、件名、差出人、本文が正しい列に入力されているか
   - 日付フォーマットが「YYYY/MM/DD」になっているか

3. **重複チェックが機能しているか**
   - 同じメールを2回実行しても、重複して転記されないか

4. **ステータスが正しく付いているか**
   - E列に「未対応」と入力されているか

### もしエラーが出たら

エラーが出た場合は、エラーメッセージをコピーして、ChatGPTに送りましょう。

**例：**
```
以下のエラーが出ました。修正してください。

[エラーメッセージをここに貼り付け]
```

---

## ステップ6：トリガー設定で自動実行

ツールが正しく動作することを確認したら、最後にトリガー設定を行いましょう。トリガーを設定することで、**毎日自動的にメール転記が実行される**ようになります。

### ⏰ トリガーとは

トリガーとは、指定した時間にGASを**自動実行**する機能です。

**例：**
- 毎日午前9時に実行
- 毎週月曜日に実行
- 毎月1日に実行

一度設定すれば、**完全放置でOK！** パソコンの電源が入っていなくても、スプレッドシートを閉じていても、GASは自動で動き続けます。

### トリガー設定の手順

#### 1. GASエディタでトリガー画面を開く

1. スクリプトエディタの左サイドバーにある「**⏰ トリガー**」アイコンをクリック
2. 右下の「**+ トリガーを追加**」ボタンをクリック

#### 2. トリガー設定画面で項目を入力

「トリガーを追加」画面が開きます。以下の項目を設定しましょう。

| 項目 | 設定内容 | 説明 |
|------|---------|------|
| **実行する関数を選択** | `transferEmailsToSheet` | 実行したい関数名を選択 |
| **イベントのソースを選択** | 時間主導型 | 時間で自動実行する場合は「時間主導型」 |
| **時間ベースのトリガーのタイプを選択** | 日付ベースのタイマー | 毎日実行する場合は「日付ベースのタイマー」 |
| **時刻を選択** | 午前9時〜10時 | 実行したい時間帯を選択 |

#### 3. 保存をクリック

設定が完了したら、「**保存**」ボタンをクリックします。

#### 4. トリガー設定完了！

トリガー一覧に、設定したトリガーが表示されます。これで、毎日午前9時〜10時の間に、自動的にメール転記が実行されるようになりました。

### 実践①を自動実行する設定例

実践①（メール転記ツール）を毎朝自動実行する場合の推奨設定：

- **イベントのソース**: 時間主導型
- **タイプ**: 日付ベースのタイマー
- **時刻**: 午前9時〜10時

これにより、**毎朝9時に注文メールを自動転記**できます。

### ⚠️ やりすぎ注意！実行時間制限

トリガーを設定する際は、**実行頻度**に注意しましょう。

#### 分ベースのタイマーは要注意

**分ベースのタイマー**（例：5分おき、10分おき）は、実行回数が多すぎて制限に引っかかる可能性があります。

**例：**
- 5分おき = 1日288回実行
- 無料枠は**1日90分**の実行時間制限
- → 制限オーバーでエラーになる可能性あり！

#### 推奨設定

**✅ 推奨：**
- **日付ベースのタイマー**（毎日1回）
- **時間ベースのタイマー**（1時間以上の間隔）

**❌ 避けるべき：**
- 5分おき、10分おきなどの短い間隔

#### GASの実行時間制限

無料アカウント（Googleアカウント）の場合：
- **1回の実行時間上限**: 約6分
- **1日の実行時間上限**: 90分

有料アカウント（Google Workspace）の場合：
- **1回の実行時間上限**: 約6分
- **1日の実行時間上限**: 6時間

---

## ✅ まとめ

この実践では、以下のことを学びました：

- Gmailから特定のメールを検索し、スプレッドシートに転記する方法
- 初回承認の手順（GASにGmailやスプレッドシートへのアクセス権限を与える）
- トリガー設定で毎日自動実行する方法
- トリガー設定時の注意点（実行頻度と時間制限）

次の実践では、CSVファイルをスプレッドシートに自動転記する方法を学びます。お疲れ様でした！
